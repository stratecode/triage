# TrIAge API - Postman Collection Setup

## Overview

This Postman collection provides complete access to the TrIAge API endpoints for daily plan generation, task management, and approval workflows.

## Import Instructions

1. Open Postman
2. Click **Import** button (top left)
3. Select the `postman_collection.json` file
4. The collection will appear in your workspace

## Configuration

### Environment Variables

After importing, configure these collection variables:

1. Click on the collection name
2. Go to the **Variables** tab
3. Update the following values:

| Variable | Description | Example |
|----------|-------------|---------|
| `base_url` | Your API Gateway endpoint URL | `https://abc123.execute-api.eu-south-2.amazonaws.com/dev` |
| `jwt_token` | Your JWT authentication token | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` |
| `today` | Auto-set to current date | `2026-02-17` |

### Getting Your API URL

After deploying with SAM:

```bash
aws cloudformation describe-stacks \
  --stack-name triage-api \
  --query 'Stacks[0].Outputs[?OutputKey==`ApiUrl`].OutputValue' \
  --output text
```

Or check the deployment output:

```bash
sam deploy --guided
# Look for: "ApiUrl" in the outputs
```

### Getting Your JWT Token

The JWT token is generated by your authentication system. For testing purposes, you can:

1. Use your existing authentication flow
2. Generate a test token using your JWT secret
3. Contact your system administrator

## Available Endpoints

### Health Check
- **GET** `/api/v1/health`
- No authentication required
- Verifies API is running

### Generate Daily Plan
- **POST** `/api/v1/plan`
- Generates a new daily plan with priorities and admin tasks
- Optional parameters: `date`, `closure_rate`

### Get Plan by Date
- **GET** `/api/v1/plan/{date}`
- Retrieves existing plan for specific date
- Date format: `YYYY-MM-DD`

### Approve Plan
- **POST** `/api/v1/plan/{date}/approve`
- Approve or reject a generated plan
- Required: `approved` (boolean)
- Optional: `feedback`, `modifications`

### Decompose Task
- **POST** `/api/v1/task/{taskId}/decompose`
- Breaks down long-running tasks into subtasks
- Optional: `target_days` (default: 1)

## Usage Examples

### 1. Check API Health

```http
GET {{base_url}}/api/v1/health
```

Expected response:
```json
{
  "status": "healthy",
  "service": "triage-api",
  "version": "0.1.0",
  "timestamp": "2026-02-17T10:30:00.000Z"
}
```

### 2. Generate Today's Plan

```http
POST {{base_url}}/api/v1/plan
Content-Type: application/json

{}
```

### 3. Generate Plan for Specific Date

```http
POST {{base_url}}/api/v1/plan
Content-Type: application/json

{
  "date": "2026-02-20",
  "closure_rate": 0.75
}
```

### 4. Approve a Plan

```http
POST {{base_url}}/api/v1/plan/2026-02-17/approve
Content-Type: application/json

{
  "approved": true,
  "feedback": "Looks good, ready to start"
}
```

### 5. Decompose a Task

```http
POST {{base_url}}/api/v1/task/PROJ-123/decompose
Content-Type: application/json

{
  "target_days": 1
}
```

## Authentication

All endpoints (except `/health`) require JWT authentication via the `Authorization` header:

```
Authorization: Bearer <your-jwt-token>
```

The collection is pre-configured to use the `{{jwt_token}}` variable automatically.

## Response Formats

### Success Response

```json
{
  "success": true,
  "data": { ... }
}
```

### Error Response

```json
{
  "success": false,
  "error": "Error message description"
}
```

## Testing Workflow

1. **Health Check**: Verify API is accessible
2. **Generate Plan**: Create a daily plan
3. **Review Plan**: Check the generated priorities and admin tasks
4. **Approve/Reject**: Submit your approval decision
5. **Decompose Tasks**: Break down any long-running tasks if needed

## Troubleshooting

### 401 Unauthorized
- Check your JWT token is valid and not expired
- Verify the token is correctly set in collection variables

### 500 Internal Server Error
- Check CloudWatch logs for detailed error messages
- Verify JIRA credentials are correctly configured in AWS Secrets Manager

### 404 Not Found
- Verify the API Gateway URL is correct
- Check the endpoint path matches the documentation

## CORS Configuration

The API is configured to accept requests from any origin (`*`). For production, restrict this to your specific domains.

## Rate Limiting

Currently, no rate limiting is enforced. Monitor your usage and implement throttling if needed.

## Support

For issues or questions:
- Check CloudWatch logs: `/aws/lambda/triage-*`
- Review API Gateway logs
- Consult the main README.md for deployment details

## License

TrIAge - Copyright (C) 2026 StrateCode  
Licensed under the GNU Affero General Public License v3 (AGPLv3)
